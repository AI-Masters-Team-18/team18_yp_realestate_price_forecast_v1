# ciam.ru
Сначала мы хотели взять объявления о квартирах с Циана (данные доступны по [ссылке](https://docs.google.com/spreadsheets/d/1ELdfCPNquxhM2xncnTkmP54wVcz2wNFs/edit?usp=sharing&ouid=111936223586231967866&rtpof=true&sd=true))

Первый датасет собрали с помощью функции [getflats()](https://github.com/lenarsaitov/cianparser/tree/main?tab=readme-ov-file#метод-get_flats) в общедоступном парсере [CianParser](https://github.com/lenarsaitov/cianparser/tree/main), Сергей добавил в функцию парсинг на основе метров и в результате мы собрали 89 тысяч записей батчами в диапазонах от ±15 м^2 и до максимально доступных значений площади от студий и до максимального доступного количества комнат. Позже отфильтровали продажи доль квартир (детали ниже) и объединили результаты парсинга в один датафрейм (смотри concatenate_dataset.py)


Планировалось использовать только CianParser для всех, верхнеуровневых и детальных, запросов, но 
* У нас возникала 403 ошибка при попытке получения детальных признаков по квартире (with_extra_data=True): похоже Циан идентифицировал эти запросы как автоматизированные
* Также возникала ошибка No connection to proxy - публично доступные прокси серверы, используемые в парсере, всегда были недоступны

Поэтому мы решили сделать детальный парсер самим, однако возникло несколько трудностей
* Пул прокси серверов - мы использовали решение [web unlocker от BrightData](https://brightdata.com/products/web-unlocker),смогли собрать 635 строк с дополнительными атрибутами (подробнее о них ниже), но бесплатная версия не позволяет собрать больше данных. Подключение к прокси реализовано в функции [proxy_request](https://github.com/AI-Masters-Team-18/team18_yp_realestate_price_forecast_v1/blob/cian_detail_page_parse_feature/parse_detailed_cian_page.py)
* Selenium - также, как альтернатива подключению к пулу прокси серверов, реализовал в функции [selenium_request](https://github.com/AI-Masters-Team-18/team18_yp_realestate_price_forecast_v1/blob/cian_detail_page_parse_feature/parse_detailed_cian_page.py) подключение к детальным страницам циана через Selenium решение - при проходе по 4 рандомным ссылкам работает с переменным успехом - отсутсвует идемпотентность парсинга. Пока не разобрались, в чем причины такого поведения, но это решение хоть и медленнее, должно обеспечить сбор дополнительных данных. На данный момент детальные данные не собраны для всех url страниц.
* Реализация самого детального парсинга представлена в файле Initiate_concatenate_parsing_detailed_info.ipynb

Признаки:
* author (88131 non-null значений, тип object) — имя автора, создавшего объявление

* author_type (88216 non-null значений, тип object) — тип автора, создавшего объявление (например, Застройщик, агент, риэлтор и др.).

* url (88947 non-null значений, тип object) — URL-адрес страницы с объявлением.

* location (88947 non-null значений, тип object) — город (в данном случае во всех записях Москва)

* deal_type (88947 non-null значений, тип object) — тип сделки (в данном случае во всех записях sale).

* accommodation_type (88947 non-null значений, тип object) — тип жилья (в данном случае во всех записях flat).

* floor (88947 non-null значений, тип int64) — этаж, на котором находится объект.

* floors_count (88947 non-null значений, тип int64) — общее количество этажей в здании.

* rooms_count (88947 non-null значений, тип int64) — количество комнат в объекте.
  * Убрали строки, в которых продается только доля квартиры (идентифицировалось парсером как rooms_count=-1).
  * В студиях на данный момент предполагаем, что нет квартир, которые продаются долями.

* total_meters (88947 non-null значений, тип float64) — общая площадь объекта в квадратных метрах.

* price (88061 non-null значений, тип float64) — цена объекта.

* district (77156 non-null значений, тип object) — район, в котором находится объект.

* street (77832 non-null значений, тип object) — улица, на которой расположен объект.

* house_number (82167 non-null значений, тип object) — номер дома.

* underground (87282 non-null значений, тип object) — ближайшая станция метро.

* residential_complex (47102 non-null значений, тип object) — название жилого комплекса (если имеется).

Следующие атрибуты в исходном датасете принимают null/nan значения:

* price (886) - возможные варианты обработки
  * 1) уберем, так как обучение без целевой переменной невозможно
  * либо 2) дополним при проходе по датасету детальным парсером
* district (11791) & street (11115) - возможные варианты обработки
  1) используем [Яндекс Геокодер](https://yandex.ru/dev/geocode/doc/ru/) для заполнения недостающих значений на основе наименования ЖК
  2) используем детальный самописный парсер, возьмем значения из детальных страниц циана
* house_number (6780) - заполнить дефолтным значением 0, тк мало влияет на целевую переменную
* underground (1665) - заполним значениями из детального парсинга c помощью selenuim, либо заполним дефолтным значением far
* residential_complex (41845)
  * убираем весь столбец, тк название ЖК не влияет на цену
  * либо заполняем дефолтным значением Not Available, так как в некоторых ЖК всегда выше средних

Атрибуты из детального парсера:
* mins_to_underground (float64) - количество минут пешком до метро
 * из html контента страницы нельзя однозначно определить, пешком это или на машине, на данный момент все собранные значения будут определяться как пешком
* housing_type (object) - тип жилья (например Новостройка, Вторичка / Апартаменты, Вторичка и так далее)
* ceiling_height_m (float64) - высота потолков
* bathroom_type (object) - тип санузла ('1 совмещенный', '1 раздельный' и т.д.)
* view (object) - вид из окон ('Во двор' 'На улицу' 'На улицу и двор')
* renovation_type (object) - тип ремонта ('Без отделки', 'Косметический', 'Евроремонт' и т.д.)
* house_material_type (object) - тип дома ('Монолитно-кирпичный' 'Монолитный', 'Кирпичный', 'Панельный' и т.д.)
* parking (object) - тип парковки
* living_area (float64) - размер жилой площади 
* kitchen_area (float64) - размер кухонной площади
* construction_year (float64) - год постройки
* house_commisioned (object) -  информация о сдаче дома (сдан/ не сдан)
* price_per_meter (float64) - цена за квадратный метр
* deal_conditions (object) - тип условий заключения сделки при покупке недвижимости ('долевое участие (214-ФЗ)', 'свободная продажа', 'переуступка')
* mortgage_availability (object) - возможно ли оформление ипотеки
* transport_accessibility_score (float64) - оценка транспортной доступности от ЦИАН (при наличии)

____
# m2.ru
Из-за возникающих трудностей в парсинге Циана мы решили поменять основу. По совету куратора *Тимура Ермешева* выбор пал на сайт [m2.ru](m2.ru)

Размер нового датасета 112635х56. [Ссылка](https://drive.google.com/file/d/1ELdfCPNquxhM2xncnTkmP54wVcz2wNFs/view) на данные

Признаки:
- **ссылка (112635 non-null значений, тип object)**  
  Ссылка на страницу объявления.

- **до центра (106897 non-null значений, тип bject)**  
  Расстояние до центра города, указано в километрах.

- **комнат (112635 non-null значений, тип object)**  
  Количество комнат в квартире.

- **Площадь квартиры (112583 non-null значений, тип object)**  
  Общая площадь квартиры, указана в квадратных метрах.

- **Жилая площадь (90732 non-null значений, тип object)**  
  Жилая площадь квартиры, указана в квадратных метрах.

- **Этаж (111822 non-null значений, тип float64)**  
  Этаж, на котором расположена квартира.

- **Санузел (71990 non-null значений, тип object)**  
  Тип санузла (например, раздельный или совмещённый).

- **Кол-во санузлов (90622 non-null значений, тип float64)**  
  Количество санузлов в квартире.

- **Ремонт (48258 non-null значений, тип object)**  
  Состояние ремонта в квартире (например, без ремонта, евро).

- **Вид из окна (61723 non-null значений, тип object)**  
  Вид из окна (например, во двор или на улицу).

- **Год постройки (20837 non-null значений, тип float64)**  
  Год постройки здания.

- **Высота потолков (83705 non-null значений, тип object)**  
  Высота потолков в квартире, указана в метрах.

- **Лифт (85074 non-null значений, тип object)**  
  Информация о наличии лифта.

- **Материал стен (95838 non-null значений, тип object)**  
  Материал, из которого построено здание (например, монолит).

- **Парковка (60672 non-null значений, тип object)**  
  Информация о наличии парковки.

- **описание (111495 non-null значений, тип object)**  
  Текстовое описание квартиры в объявлении.

- **цена (112635 non-null значений, тип object)**  
  Стоимость объекта недвижимости.

- **адрес (112635 non-null значений, тип object)**  
  Адрес объекта недвижимости.

- **станция1 (112305 non-null значений, тип object)**  
  Название ближайшей станции метро.

- **время_до_станции1 (112305 non-null значений, тип float64)**  
  Время до ближайшей станции метро (в минутах).

- **пешком1 (112305 non-null значений, тип float64)**  
  Информация о том, возможно ли добраться пешком до станции метро (1 — да, 0 — нет).

- **станция2 (112200 non-null значений, тип object)**  
  Название второй ближайшей станции метро.

- **время_до_станции2 (112200 non-null значений, тип float64)**  
  Время до второй станции метро (в минутах).

- **пешком2 (112200 non-null значений, тип float64)**  
  Возможность пешей доступности до второй станции метро.

- **станция3 (112167 non-null значений, тип object)**  
  Название третьей ближайшей станции метро.

- **время_до_станции3 (112167 non-null значений, тип float64)**  
  Время до третьей станции метро (в минутах).

- **пешком3 (112167 non-null значений, тип float64)**  
  Возможность пешей доступности до третьей станции метро.

- **Этажей в доме (111822 non-null значений, тип float64)**  
  Общее количество этажей в здании.

- **Отделка (34564 non-null значений, тип object)**  
  Тип отделки (например, черновая, чистовая).

- **Срок сдачи (49758 non-null значений, тип object)**  
  Срок сдачи объекта (для новостроек).

- **Временная эпоха (16636 non-null значений, тип object)**  
  Архитектурная эпоха здания.

- **Отопление (32536 non-null значений, тип object)**  
  Тип отопления в здании.

- **Тип жилья (10001 non-null значений, тип object)**  
  Тип объекта недвижимости (например, апартаменты).

- **Балкон/лоджия (37456 non-null значений, тип object)**  
  Наличие балкона или лоджии.

- **Серия дома (21390 non-null значений, тип object)**  
  Серия дома.

- **Кондиционер (1575 non-null значений, тип object)**  
  Информация о наличии кондиционера.

- **Мебель (5258 non-null значений, тип object)**  
  Информация о наличии мебели.

- **Кухонная мебель (1529 non-null значений, тип object)**  
  Информация о наличии кухонной мебели.

- **Реновация (967 non-null значений, тип object)**  
  Участие дома в программе реновации.

- **Территория (15446 non-null значений, тип object)**  
  Описание придомовой территории.

- **Вид из окон (11705 non-null значений, тип object)**  
  Описание вида из окон.

- **Холодильник (491 non-null значений, тип object)**  
  Наличие холодильника.

- **Стиральная машина (470 non-null значений, тип object)**  
  Наличие стиральной машины.

- **Хорошая школа (2763 non-null значений, тип object)**  
  Информация о наличии хорошей школы поблизости.

- **Консьерж (5167 non-null значений, тип object)**  
  Информация о наличии консьержа.

- **Парк или зона отдыха (3088 non-null значений, тип object)**  
  Наличие парка или зоны отдыха поблизости.

- **Фитнес клуб (2188 non-null значений, тип object)**  
  Информация о наличии фитнес-клуба поблизости.

- **Детский сад (4127 non-null значений, тип object)**  
  Наличие детского сада поблизости.

- **Посудомойка (245 non-null значений, тип object)**  
  Наличие посудомоечной машины.

- **Интернет (754 non-null значений, тип object)**  
  Наличие интернета.

- **Телевизор (221 non-null значений, тип object)**  
  Наличие телевизора.

- **Торговый центр (3292 non-null значений, тип object)**  
  Наличие торгового центра поблизости.

- **Хорошие школы (3109 non-null значений, тип object)**  
  Наличие нескольких хороших школ поблизости.

- **Source_File (112635 non-null значений, тип object)**  
  Источник данных.

- **Sheet_Name (112635 non-null значений, тип object)**  
  Название листа в файле Excel.

- **Площадь кухни (87710 non-null значений, тип object)**  
  Площадь кухни в квартире.
